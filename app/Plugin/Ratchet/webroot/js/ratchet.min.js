var swfobject=function(){function e(){if(!G){try{var e=P.getElementsByTagName("body")[0].appendChild(h("span"));e.parentNode.removeChild(e)}catch(n){return}G=!0;for(var t=U.length,o=0;t>o;o++)U[o]()}}function n(e){G?e():U[U.length]=e}function t(e){if(typeof R.addEventListener!=N)R.addEventListener("load",e,!1);else if(typeof P.addEventListener!=N)P.addEventListener("load",e,!1);else if(typeof R.attachEvent!=N)g(R,"onload",e);else if("function"==typeof R.onload){var n=R.onload;R.onload=function(){n(),e()}}else R.onload=e}function o(){B?r():i()}function r(){var e=P.getElementsByTagName("body")[0],n=h(T);n.setAttribute("type",x);var t=e.appendChild(n);if(t){var o=0;!function(){if(typeof t.GetVariable!=N){var r=t.GetVariable("$version");r&&(r=r.split(" ")[1].split(","),V.pv=[parseInt(r[0],10),parseInt(r[1],10),parseInt(r[2],10)])}else if(10>o)return o++,void setTimeout(arguments.callee,10);e.removeChild(n),t=null,i()}()}else i()}function i(){var e=F.length;if(e>0)for(var n=0;e>n;n++){var t=F[n].id,o=F[n].callbackFn,r={success:!1,id:t};if(V.pv[0]>0){var i=d(t);if(i)if(!v(F[n].swfVersion)||V.wk&&V.wk<312)if(F[n].expressInstall&&a()){var u={};u.data=F[n].expressInstall,u.width=i.getAttribute("width")||"0",u.height=i.getAttribute("height")||"0",i.getAttribute("class")&&(u.styleclass=i.getAttribute("class")),i.getAttribute("align")&&(u.align=i.getAttribute("align"));for(var p={},f=i.getElementsByTagName("param"),_=f.length,b=0;_>b;b++)"movie"!=f[b].getAttribute("name").toLowerCase()&&(p[f[b].getAttribute("name")]=f[b].getAttribute("value"));c(u,p,t,o)}else l(i),o&&o(r);else S(t,!0),o&&(r.success=!0,r.ref=s(t),o(r))}else if(S(t,!0),o){var h=s(t);h&&typeof h.SetVariable!=N&&(r.success=!0,r.ref=h),o(r)}}}function s(e){var n=null,t=d(e);if(t&&"OBJECT"==t.nodeName)if(typeof t.SetVariable!=N)n=t;else{var o=t.getElementsByTagName(T)[0];o&&(n=o)}return n}function a(){return!Y&&v("6.0.65")&&(V.win||V.mac)&&!(V.wk&&V.wk<312)}function c(e,n,t,o){Y=!0,k=o||null,C={success:!1,id:t};var r=d(t);if(r){"OBJECT"==r.nodeName?(m=u(r),y=null):(m=r,y=t),e.id=M,(typeof e.width==N||!/%$/.test(e.width)&&parseInt(e.width,10)<310)&&(e.width="310"),(typeof e.height==N||!/%$/.test(e.height)&&parseInt(e.height,10)<137)&&(e.height="137"),P.title=P.title.slice(0,47)+" - Flash Player Installation";var i=V.ie&&V.win?"ActiveX":"PlugIn",s="MMredirectURL="+R.location.toString().replace(/&/g,"%26")+"&MMplayerType="+i+"&MMdoctitle="+P.title;if(typeof n.flashvars!=N?n.flashvars+="&"+s:n.flashvars=s,V.ie&&V.win&&4!=r.readyState){var a=h("div");t+="SWFObjectNew",a.setAttribute("id",t),r.parentNode.insertBefore(a,r),r.style.display="none",function(){4==r.readyState?r.parentNode.removeChild(r):setTimeout(arguments.callee,10)}()}p(e,n,t)}}function l(e){if(V.ie&&V.win&&4!=e.readyState){var n=h("div");e.parentNode.insertBefore(n,e),n.parentNode.replaceChild(u(e),n),e.style.display="none",function(){4==e.readyState?e.parentNode.removeChild(e):setTimeout(arguments.callee,10)}()}else e.parentNode.replaceChild(u(e),e)}function u(e){var n=h("div");if(V.win&&V.ie)n.innerHTML=e.innerHTML;else{var t=e.getElementsByTagName(T)[0];if(t){var o=t.childNodes;if(o)for(var r=o.length,i=0;r>i;i++)1==o[i].nodeType&&"PARAM"==o[i].nodeName||8==o[i].nodeType||n.appendChild(o[i].cloneNode(!0))}}return n}function p(e,n,t){var o,r=d(t);if(V.wk&&V.wk<312)return o;if(r)if(typeof e.id==N&&(e.id=t),V.ie&&V.win){var i="";for(var s in e)e[s]!=Object.prototype[s]&&("data"==s.toLowerCase()?n.movie=e[s]:"styleclass"==s.toLowerCase()?i+=' class="'+e[s]+'"':"classid"!=s.toLowerCase()&&(i+=" "+s+'="'+e[s]+'"'));var a="";for(var c in n)n[c]!=Object.prototype[c]&&(a+='<param name="'+c+'" value="'+n[c]+'" />');r.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+i+">"+a+"</object>",j[j.length]=e.id,o=d(e.id)}else{var l=h(T);l.setAttribute("type",x);for(var u in e)e[u]!=Object.prototype[u]&&("styleclass"==u.toLowerCase()?l.setAttribute("class",e[u]):"classid"!=u.toLowerCase()&&l.setAttribute(u,e[u]));for(var p in n)n[p]!=Object.prototype[p]&&"movie"!=p.toLowerCase()&&f(l,p,n[p]);r.parentNode.replaceChild(l,r),o=l}return o}function f(e,n,t){var o=h("param");o.setAttribute("name",n),o.setAttribute("value",t),e.appendChild(o)}function _(e){var n=d(e);n&&"OBJECT"==n.nodeName&&(V.ie&&V.win?(n.style.display="none",function(){4==n.readyState?b(e):setTimeout(arguments.callee,10)}()):n.parentNode.removeChild(n))}function b(e){var n=d(e);if(n){for(var t in n)"function"==typeof n[t]&&(n[t]=null);n.parentNode.removeChild(n)}}function d(e){var n=null;try{n=P.getElementById(e)}catch(t){}return n}function h(e){return P.createElement(e)}function g(e,n,t){e.attachEvent(n,t),H[H.length]=[e,n,t]}function v(e){var n=V.pv,t=e.split(".");return t[0]=parseInt(t[0],10),t[1]=parseInt(t[1],10)||0,t[2]=parseInt(t[2],10)||0,n[0]>t[0]||n[0]==t[0]&&n[1]>t[1]||n[0]==t[0]&&n[1]==t[1]&&n[2]>=t[2]?!0:!1}function E(e,n,t,o){if(!V.ie||!V.mac){var r=P.getElementsByTagName("head")[0];if(r){var i=t&&"string"==typeof t?t:"screen";if(o&&(W=null,O=null),!W||O!=i){var s=h("style");s.setAttribute("type","text/css"),s.setAttribute("media",i),W=r.appendChild(s),V.ie&&V.win&&typeof P.styleSheets!=N&&P.styleSheets.length>0&&(W=P.styleSheets[P.styleSheets.length-1]),O=i}V.ie&&V.win?W&&typeof W.addRule==T&&W.addRule(e,n):W&&typeof P.createTextNode!=N&&W.appendChild(P.createTextNode(e+" {"+n+"}"))}}}function S(e,n){if(K){var t=n?"visible":"hidden";G&&d(e)?d(e).style.visibility=t:E("#"+e,"visibility:"+t)}}function w(e){var n=/[\\\"<>\.;]/,t=null!=n.exec(e);return t&&typeof encodeURIComponent!=N?encodeURIComponent(e):e}{var m,y,k,C,W,O,N="undefined",T="object",A="Shockwave Flash",I="ShockwaveFlash.ShockwaveFlash",x="application/x-shockwave-flash",M="SWFObjectExprInst",L="onreadystatechange",R=window,P=document,D=navigator,B=!1,U=[o],F=[],j=[],H=[],G=!1,Y=!1,K=!0,V=function(){var e=typeof P.getElementById!=N&&typeof P.getElementsByTagName!=N&&typeof P.createElement!=N,n=D.userAgent.toLowerCase(),t=D.platform.toLowerCase(),o=/win/.test(t?t:n),r=/mac/.test(t?t:n),i=/webkit/.test(n)?parseFloat(n.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):!1,s=!1,a=[0,0,0],c=null;if(typeof D.plugins!=N&&typeof D.plugins[A]==T)c=D.plugins[A].description,!c||typeof D.mimeTypes!=N&&D.mimeTypes[x]&&!D.mimeTypes[x].enabledPlugin||(B=!0,s=!1,c=c.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),a[0]=parseInt(c.replace(/^(.*)\..*$/,"$1"),10),a[1]=parseInt(c.replace(/^.*\.(.*)\s.*$/,"$1"),10),a[2]=/[a-zA-Z]/.test(c)?parseInt(c.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0);else if(typeof R.ActiveXObject!=N)try{var l=new ActiveXObject(I);l&&(c=l.GetVariable("$version"),c&&(s=!0,c=c.split(" ")[1].split(","),a=[parseInt(c[0],10),parseInt(c[1],10),parseInt(c[2],10)]))}catch(u){}return{w3:e,pv:a,wk:i,ie:s,win:o,mac:r}}();!function(){V.w3&&((typeof P.readyState!=N&&"complete"==P.readyState||typeof P.readyState==N&&(P.getElementsByTagName("body")[0]||P.body))&&e(),G||(typeof P.addEventListener!=N&&P.addEventListener("DOMContentLoaded",e,!1),V.ie&&V.win&&(P.attachEvent(L,function(){"complete"==P.readyState&&(P.detachEvent(L,arguments.callee),e())}),R==top&&!function(){if(!G){try{P.documentElement.doScroll("left")}catch(n){return void setTimeout(arguments.callee,0)}e()}}()),V.wk&&!function(){return G?void 0:/loaded|complete/.test(P.readyState)?void e():void setTimeout(arguments.callee,0)}(),t(e)))}(),function(){V.ie&&V.win&&window.attachEvent("onunload",function(){for(var e=H.length,n=0;e>n;n++)H[n][0].detachEvent(H[n][1],H[n][2]);for(var t=j.length,o=0;t>o;o++)_(j[o]);for(var r in V)V[r]=null;V=null;for(var i in swfobject)swfobject[i]=null;swfobject=null})}()}return{registerObject:function(e,n,t,o){if(V.w3&&e&&n){var r={};r.id=e,r.swfVersion=n,r.expressInstall=t,r.callbackFn=o,F[F.length]=r,S(e,!1)}else o&&o({success:!1,id:e})},getObjectById:function(e){return V.w3?s(e):void 0},embedSWF:function(e,t,o,r,i,s,l,u,f,_){var b={success:!1,id:t};V.w3&&!(V.wk&&V.wk<312)&&e&&t&&o&&r&&i?(S(t,!1),n(function(){o+="",r+="";var n={};if(f&&typeof f===T)for(var d in f)n[d]=f[d];n.data=e,n.width=o,n.height=r;var h={};if(u&&typeof u===T)for(var g in u)h[g]=u[g];if(l&&typeof l===T)for(var E in l)typeof h.flashvars!=N?h.flashvars+="&"+E+"="+l[E]:h.flashvars=E+"="+l[E];if(v(i)){var w=p(n,h,t);n.id==t&&S(t,!0),b.success=!0,b.ref=w}else{if(s&&a())return n.data=s,void c(n,h,t,_);S(t,!0)}_&&_(b)})):_&&_(b)},switchOffAutoHideShow:function(){K=!1},ua:V,getFlashPlayerVersion:function(){return{major:V.pv[0],minor:V.pv[1],release:V.pv[2]}},hasFlashPlayerVersion:v,createSWF:function(e,n,t){return V.w3?p(e,n,t):void 0},showExpressInstall:function(e,n,t,o){V.w3&&a()&&c(e,n,t,o)},removeSWF:function(e){V.w3&&_(e)},createCSS:function(e,n,t,o){V.w3&&E(e,n,t,o)},addDomLoadEvent:n,addLoadEvent:t,getQueryParamValue:function(e){var n=P.location.search||P.location.hash;if(n){if(/\?/.test(n)&&(n=n.split("?")[1]),null==e)return w(n);for(var t=n.split("&"),o=0;o<t.length;o++)if(t[o].substring(0,t[o].indexOf("="))==e)return w(t[o].substring(t[o].indexOf("=")+1))}return""},expressInstallCallback:function(){if(Y){var e=d(M);e&&m&&(e.parentNode.replaceChild(m,e),y&&(S(y,!0),V.ie&&V.win&&(m.style.display="block")),k&&k(C)),Y=!1}}}}();!function(){if(window.WEB_SOCKET_FORCE_FLASH);else{if(window.WebSocket)return;if(window.MozWebSocket)return void(window.WebSocket=MozWebSocket)}var e;return e=window.WEB_SOCKET_LOGGER?WEB_SOCKET_LOGGER:window.console&&window.console.log&&window.console.error?window.console:{log:function(){},error:function(){}},swfobject.getFlashPlayerVersion().major<10?void e.error("Flash Player >= 10.0.0 is required."):("file:"==location.protocol&&e.error("WARNING: web-socket-js doesn't work in file:///... URL unless you set Flash Security Settings properly. Open the page via Web server i.e. http://..."),window.WebSocket=function(e,n,t,o,r){var i=this;i.__id=WebSocket.__nextId++,WebSocket.__instances[i.__id]=i,i.readyState=WebSocket.CONNECTING,i.bufferedAmount=0,i.__events={},n?"string"==typeof n&&(n=[n]):n=[],i.__createTask=setTimeout(function(){WebSocket.__addTask(function(){i.__createTask=null,WebSocket.__flash.create(i.__id,e,n,t||null,o||0,r||null)})},0)},WebSocket.prototype.send=function(e){if(this.readyState==WebSocket.CONNECTING)throw"INVALID_STATE_ERR: Web Socket connection has not been established";var n=WebSocket.__flash.send(this.__id,encodeURIComponent(e));return 0>n?!0:(this.bufferedAmount+=n,!1)},WebSocket.prototype.close=function(){return this.__createTask?(clearTimeout(this.__createTask),this.__createTask=null,void(this.readyState=WebSocket.CLOSED)):void(this.readyState!=WebSocket.CLOSED&&this.readyState!=WebSocket.CLOSING&&(this.readyState=WebSocket.CLOSING,WebSocket.__flash.close(this.__id)))},WebSocket.prototype.addEventListener=function(e,n){e in this.__events||(this.__events[e]=[]),this.__events[e].push(n)},WebSocket.prototype.removeEventListener=function(e,n){if(e in this.__events)for(var t=this.__events[e],o=t.length-1;o>=0;--o)if(t[o]===n){t.splice(o,1);break}},WebSocket.prototype.dispatchEvent=function(e){for(var n=this.__events[e.type]||[],t=0;t<n.length;++t)n[t](e);var o=this["on"+e.type];o&&o.apply(this,[e])},WebSocket.prototype.__handleEvent=function(e){"readyState"in e&&(this.readyState=e.readyState),"protocol"in e&&(this.protocol=e.protocol);var n;if("open"==e.type||"error"==e.type)n=this.__createSimpleEvent(e.type);else if("close"==e.type)n=this.__createSimpleEvent("close"),n.wasClean=e.wasClean?!0:!1,n.code=e.code,n.reason=e.reason;else{if("message"!=e.type)throw"unknown event type: "+e.type;var t=decodeURIComponent(e.message);n=this.__createMessageEvent("message",t)}this.dispatchEvent(n)},WebSocket.prototype.__createSimpleEvent=function(e){if(document.createEvent&&window.Event){var n=document.createEvent("Event");return n.initEvent(e,!1,!1),n}return{type:e,bubbles:!1,cancelable:!1}},WebSocket.prototype.__createMessageEvent=function(e,n){if(window.MessageEvent&&"function"==typeof MessageEvent&&!window.opera)return new MessageEvent("message",{view:window,bubbles:!1,cancelable:!1,data:n});if(document.createEvent&&window.MessageEvent&&!window.opera){var t=document.createEvent("MessageEvent");return t.initMessageEvent("message",!1,!1,n,null,null,window,null),t}return{type:e,data:n,bubbles:!1,cancelable:!1}},WebSocket.CONNECTING=0,WebSocket.OPEN=1,WebSocket.CLOSING=2,WebSocket.CLOSED=3,WebSocket.__isFlashImplementation=!0,WebSocket.__initialized=!1,WebSocket.__flash=null,WebSocket.__instances={},WebSocket.__tasks=[],WebSocket.__nextId=0,WebSocket.loadFlashPolicyFile=function(e){WebSocket.__addTask(function(){WebSocket.__flash.loadManualPolicyFile(e)})},WebSocket.__initialize=function(){if(!WebSocket.__initialized){if(WebSocket.__initialized=!0,WebSocket.__swfLocation&&(window.WEB_SOCKET_SWF_LOCATION=WebSocket.__swfLocation),!window.WEB_SOCKET_SWF_LOCATION)return void e.error("[WebSocket] set WEB_SOCKET_SWF_LOCATION to location of WebSocketMain.swf");if(!window.WEB_SOCKET_SUPPRESS_CROSS_DOMAIN_SWF_ERROR&&!WEB_SOCKET_SWF_LOCATION.match(/(^|\/)WebSocketMainInsecure\.swf(\?.*)?$/)&&WEB_SOCKET_SWF_LOCATION.match(/^\w+:\/\/([^\/]+)/)){var n=RegExp.$1;location.host!=n&&e.error("[WebSocket] You must host HTML and WebSocketMain.swf in the same host ('"+location.host+"' != '"+n+"'). See also 'How to host HTML file and SWF file in different domains' section in README.md. If you use WebSocketMainInsecure.swf, you can suppress this message by WEB_SOCKET_SUPPRESS_CROSS_DOMAIN_SWF_ERROR = true;")}var t=document.createElement("div");t.id="webSocketContainer",t.style.position="absolute",WebSocket.__isFlashLite()?(t.style.left="0px",t.style.top="0px"):(t.style.left="-100px",t.style.top="-100px");var o=document.createElement("div");o.id="webSocketFlash",t.appendChild(o),document.body.appendChild(t),swfobject.embedSWF(WEB_SOCKET_SWF_LOCATION,"webSocketFlash","1","1","10.0.0",null,null,{hasPriority:!0,swliveconnect:!0,allowScriptAccess:"always"},null,function(n){n.success||e.error("[WebSocket] swfobject.embedSWF failed")})}},WebSocket.__onFlashInitialized=function(){setTimeout(function(){WebSocket.__flash=document.getElementById("webSocketFlash"),WebSocket.__flash.setCallerUrl(location.href),WebSocket.__flash.setDebug(!!window.WEB_SOCKET_DEBUG);for(var e=0;e<WebSocket.__tasks.length;++e)WebSocket.__tasks[e]();WebSocket.__tasks=[]},0)},WebSocket.__onFlashEvent=function(){return setTimeout(function(){try{for(var n=WebSocket.__flash.receiveEvents(),t=0;t<n.length;++t)WebSocket.__instances[n[t].webSocketId].__handleEvent(n[t])}catch(o){e.error(o)}},0),!0},WebSocket.__log=function(n){e.log(decodeURIComponent(n))},WebSocket.__error=function(n){e.error(decodeURIComponent(n))},WebSocket.__addTask=function(e){WebSocket.__flash?e():WebSocket.__tasks.push(e)},WebSocket.__isFlashLite=function(){if(!window.navigator||!window.navigator.mimeTypes)return!1;var e=window.navigator.mimeTypes["application/x-shockwave-flash"];return e&&e.enabledPlugin&&e.enabledPlugin.filename&&e.enabledPlugin.filename.match(/flashlite/i)?!0:!1},void(window.WEB_SOCKET_DISABLE_AUTO_INITIALIZATION||swfobject.addDomLoadEvent(function(){WebSocket.__initialize()})))}(),function(e){"use strict";e(function(){function e(e,t,o,r){return n(e).then(t,o,r)}function n(e){var n;return n=e instanceof r?e:c(e)?t(e):i(e)}function t(e){var n=a();try{e.then(function(e){n.resolve(e)},function(e){n.reject(e)},function(e){n.progress(e)})}catch(t){n.reject(t)}return n.promise}function o(n){return e(n,s)}function r(e){this.then=e}function i(e){var t=new r(function(t){try{return n("function"==typeof t?t(e):e)}catch(o){return s(o)}});return t}function s(e){var t=new r(function(t,o){try{return n("function"==typeof o?o(e):s(e))}catch(r){return s(r)}});return t}function a(){function e(e,n,t){return f(e,n,t)}function t(e){return b(n(e))}function o(e){return b(s(e))}function i(e){return _(e)}var c,l,u,p,f,_,b;return l=new r(e),c={then:e,resolve:t,reject:o,progress:i,notify:i,promise:l,resolver:{resolve:t,reject:o,progress:i,notify:i}},u=[],p=[],f=function(e,n,t){var o,r;return o=a(),r="function"==typeof t?function(e){try{o.notify(t(e))}catch(n){o.notify(n)}}:function(e){o.notify(e)},u.push(function(t){t.then(e,n).then(o.resolve,o.reject,r)}),p.push(r),o.promise},_=function(e){return h(p,e),e},b=function(e){return f=e.then,b=n,_=E,h(u,e),p=u=m,e},c}function c(e){return e&&"function"==typeof e.then}function l(n,t,o,r,i){return g(2,arguments),e(n,function(n){function s(e){d(e)}function c(e){b(e)}var l,u,p,f,_,b,d,h,g,E;if(g=n.length>>>0,l=Math.max(0,Math.min(t,g)),p=[],u=g-l+1,f=[],_=a(),l)for(h=_.notify,d=function(e){f.push(e),--u||(b=d=v,_.reject(f))},b=function(e){p.push(e),--l||(b=d=v,_.resolve(p))},E=0;g>E;++E)E in n&&e(n[E],c,s,h);else _.resolve(p);return _.promise.then(o,r,i)})}function u(e,n,t,o){function r(e){return n?n(e[0]):e[0]}return l(e,1,r,t,o)}function p(e,n,t,o){return g(1,arguments),_(e,E).then(n,t,o)}function f(){return _(arguments,E)}function _(n,t){return e(n,function(n){var o,r,i,s,c,l;if(i=r=n.length>>>0,o=[],l=a(),i)for(s=function(n,r){e(n,t).then(function(e){o[r]=e,--i||l.resolve(o)},l.reject)},c=0;r>c;c++)c in n?s(n[c],c):--i;else l.resolve(o);return l.promise})}function b(n,t){var o=w.call(arguments,1);return e(n,function(n){var r;return r=n.length,o[0]=function(n,o,i){return e(n,function(n){return e(o,function(e){return t(n,e,i,r)})})},S.apply(n,o)})}function d(n,t,o){var r=arguments.length>2;return e(n,function(e){return e=r?o:e,t.resolve(e),e},function(e){return t.reject(e),s(e)},function(e){return"function"==typeof t.notify&&t.notify(e),e})}function h(e,n){for(var t,o=0;t=e[o++];)t(n)}function g(e,n){for(var t,o=n.length;o>e;)if(t=n[--o],null!=t&&"function"!=typeof t)throw new Error("arg "+o+" must be a function")}function v(){}function E(e){return e}var S,w,m;return e.defer=a,e.resolve=n,e.reject=o,e.join=f,e.all=p,e.map=_,e.reduce=b,e.any=u,e.some=l,e.chain=d,e.isPromise=c,r.prototype={always:function(e,n){return this.then(e,e,n)},otherwise:function(e){return this.then(m,e)},"yield":function(e){return this.then(function(){return e})},spread:function(e){return this.then(function(n){return p(n,function(n){return e.apply(m,n)})})}},w=[].slice,S=[].reduce||function(e){var n,t,o,r,i;if(i=0,n=Object(this),r=n.length>>>0,t=arguments,t.length<=1)for(;;){if(i in n){o=n[i++];break}if(++i>=r)throw new TypeError}else o=t[1];for(;r>i;++i)i in n&&(o=e(o,n[i],i,n));return o},e})}("function"==typeof define&&define.amd?define:function(e){"object"==typeof exports?module.exports=e():this.when=e()});var AUTOBAHNJS_VERSION="?.?.?",AUTOBAHNJS_DEBUG=!0,ab=window.ab={};ab._version=AUTOBAHNJS_VERSION,function(){Array.prototype.indexOf||(Array.prototype.indexOf=function(e){"use strict";if(null===this)throw new TypeError;var n=new Object(this),t=n.length>>>0;if(0===t)return-1;var o=0;if(arguments.length>0&&(o=Number(arguments[1]),o!==o?o=0:0!==o&&1/0!==o&&o!==-1/0&&(o=(o>0||-1)*Math.floor(Math.abs(o)))),o>=t)return-1;for(var r=o>=0?o:Math.max(t-Math.abs(o),0);t>r;r++)if(r in n&&n[r]===e)return r;return-1}),Array.prototype.forEach||(Array.prototype.forEach=function(e,n){var t,o;if(null===this)throw new TypeError(" this is null or not defined");var r=new Object(this),i=r.length>>>0;if("[object Function]"!=={}.toString.call(e))throw new TypeError(e+" is not a function");for(n&&(t=n),o=0;i>o;){var s;o in r&&(s=r[o],e.call(t,s,o,r)),o++}})}(),ab._sliceUserAgent=function(e,n,t){var o=[],r=navigator.userAgent,i=r.indexOf(e),s=r.indexOf(n,i);0>s&&(s=r.length);for(var a=r.slice(i,s).split(t),c=a[1].split("."),l=0;l<c.length;++l)o.push(parseInt(c[l],10));return{name:a[0],version:o}},ab.getBrowser=function(){var e=navigator.userAgent;return e.indexOf("Chrome")>-1?ab._sliceUserAgent("Chrome"," ","/"):e.indexOf("Safari")>-1?ab._sliceUserAgent("Safari"," ","/"):e.indexOf("Firefox")>-1?ab._sliceUserAgent("Firefox"," ","/"):e.indexOf("MSIE")>-1?ab._sliceUserAgent("MSIE",";"," "):null},ab.browserNotSupportedMessage="Browser does not support WebSockets (RFC6455)",ab.deriveKey=function(e,n){if(n&&n.salt){var t=n.salt,o=n.keylen||32,r=n.iterations||1e4,i=CryptoJS.PBKDF2(e,t,{keySize:o/4,iterations:r,hasher:CryptoJS.algo.SHA256});return i.toString(CryptoJS.enc.Base64)}return e},ab._idchars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",ab._idlen=16,ab._subprotocol="wamp",ab._newid=function(){for(var e="",n=0;n<ab._idlen;n+=1)e+=ab._idchars.charAt(Math.floor(Math.random()*ab._idchars.length));return e},ab._newidFast=function(){return Math.random().toString(36)},ab.log=function(){if(window.console&&console.log)if(arguments.length>1){console.group&&console.group("Log Item");for(var e=0;e<arguments.length;e+=1)console.log(arguments[e]);console.groupEnd&&console.groupEnd()}else console.log(arguments[0])},ab._debugrpc=!1,ab._debugpubsub=!1,ab._debugws=!1,ab.debug=function(e,n){if(!("console"in window))throw"browser does not support console object";ab._debugrpc=e,ab._debugpubsub=e,ab._debugws=n},ab.version=function(){return ab._version},ab.PrefixMap=function(){var e=this;e._index={},e._rindex={}},ab.PrefixMap.prototype.get=function(e){var n=this;return n._index[e]},ab.PrefixMap.prototype.set=function(e,n){var t=this;t._index[e]=n,t._rindex[n]=e},ab.PrefixMap.prototype.setDefault=function(e){var n=this;n._index[""]=e,n._rindex[e]=""},ab.PrefixMap.prototype.remove=function(e){var n=this,t=n._index[e];t&&(delete n._index[e],delete n._rindex[t])},ab.PrefixMap.prototype.resolve=function(e,n){var t=this,o=e.indexOf(":");if(o>=0){var r=e.substring(0,o);if(t._index[r])return t._index[r]+e.substring(o+1)}return 1==n?e:null},ab.PrefixMap.prototype.shrink=function(e,n){for(var t=this,o=e.length;o>0;o-=1){var r=e.substring(0,o),i=t._rindex[r];if(i)return i+":"+e.substring(o)}return 1==n?e:null},ab._MESSAGE_TYPEID_WELCOME=0,ab._MESSAGE_TYPEID_PREFIX=1,ab._MESSAGE_TYPEID_CALL=2,ab._MESSAGE_TYPEID_CALL_RESULT=3,ab._MESSAGE_TYPEID_CALL_ERROR=4,ab._MESSAGE_TYPEID_SUBSCRIBE=5,ab._MESSAGE_TYPEID_UNSUBSCRIBE=6,ab._MESSAGE_TYPEID_PUBLISH=7,ab._MESSAGE_TYPEID_EVENT=8,ab.CONNECTION_CLOSED=0,ab.CONNECTION_LOST=1,ab.CONNECTION_RETRIES_EXCEEDED=2,ab.CONNECTION_UNREACHABLE=3,ab.CONNECTION_UNSUPPORTED=4,ab.CONNECTION_UNREACHABLE_SCHEDULED_RECONNECT=5,ab.CONNECTION_LOST_SCHEDULED_RECONNECT=6,ab._Deferred=when.defer,ab._construct=function(e,n){return"WebSocket"in window?n?new WebSocket(e,n):new WebSocket(e):"MozWebSocket"in window?n?new MozWebSocket(e,n):new MozWebSocket(e):null},ab.Session=function(e,n,t,o){var r=this;if(r._wsuri=e,r._options=o,r._websocket_onopen=n,r._websocket_onclose=t,r._websocket=null,r._websocket_connected=!1,r._session_id=null,r._wamp_version=null,r._server=null,r._calls={},r._subscriptions={},r._prefixes=new ab.PrefixMap,r._txcnt=0,r._rxcnt=0,r._websocket=r._options&&r._options.skipSubprotocolAnnounce?ab._construct(r._wsuri):ab._construct(r._wsuri,[ab._subprotocol]),!r._websocket){if(void 0!==t)return void t(ab.CONNECTION_UNSUPPORTED);throw ab.browserNotSupportedMessage}r._websocket.onmessage=function(e){ab._debugws&&(r._rxcnt+=1,console.group("WS Receive"),console.info(r._wsuri+"  ["+r._session_id+"]"),console.log(r._rxcnt),console.log(e.data),console.groupEnd());var n=JSON.parse(e.data);if(n[1]in r._calls){if(n[0]===ab._MESSAGE_TYPEID_CALL_RESULT){var t=r._calls[n[1]],o=n[2];if(ab._debugrpc&&void 0!==t._ab_callobj){console.group("WAMP Call",t._ab_callobj[2]),console.timeEnd(t._ab_tid),console.group("Arguments");for(var i=3;i<t._ab_callobj.length;i+=1){var s=t._ab_callobj[i];if(void 0===s)break;console.log(s)}console.groupEnd(),console.group("Result"),console.log(o),console.groupEnd(),console.groupEnd()}t.resolve(o)}else if(n[0]===ab._MESSAGE_TYPEID_CALL_ERROR){var a=r._calls[n[1]],c=n[2],l=n[3],u=n[4];if(ab._debugrpc&&void 0!==a._ab_callobj){console.group("WAMP Call",a._ab_callobj[2]),console.timeEnd(a._ab_tid),console.group("Arguments");for(var p=3;p<a._ab_callobj.length;p+=1){var f=a._ab_callobj[p];if(void 0===f)break;console.log(f)}console.groupEnd(),console.group("Error"),console.log(c),console.log(l),void 0!==u&&console.log(u),console.groupEnd(),console.groupEnd()}a.reject(void 0!==u?{uri:c,desc:l,detail:u}:{uri:c,desc:l})}delete r._calls[n[1]]}else if(n[0]===ab._MESSAGE_TYPEID_EVENT){var _=r._prefixes.resolve(n[1],!0);if(_ in r._subscriptions){var b=n[1],d=n[2];ab._debugpubsub&&(console.group("WAMP Event"),console.info(r._wsuri+"  ["+r._session_id+"]"),console.log(b),console.log(d),console.groupEnd()),r._subscriptions[_].forEach(function(e){e(b,d)})}}else if(n[0]===ab._MESSAGE_TYPEID_WELCOME){if(null!==r._session_id)throw"protocol error (welcome message received more than once)";r._session_id=n[1],r._wamp_version=n[2],r._server=n[3],(ab._debugrpc||ab._debugpubsub)&&(console.group("WAMP Welcome"),console.info(r._wsuri+"  ["+r._session_id+"]"),console.log(r._wamp_version),console.log(r._server),console.groupEnd()),null!==r._websocket_onopen&&r._websocket_onopen()}},r._websocket.onopen=function(){if(r._websocket.protocol!==ab._subprotocol)if("undefined"==typeof r._websocket.protocol)ab._debugws&&(console.group("WS Warning"),console.info(r._wsuri),console.log("WebSocket object has no protocol attribute: WAMP subprotocol check skipped!"),console.groupEnd());else{if(!r._options||!r._options.skipSubprotocolCheck)throw r._websocket.close(1e3,"server does not speak WAMP"),"server does not speak WAMP (but '"+r._websocket.protocol+"' !)";ab._debugws&&(console.group("WS Warning"),console.info(r._wsuri),console.log("Server does not speak WAMP, but subprotocol check disabled by option!"),console.log(r._websocket.protocol),console.groupEnd())}ab._debugws&&(console.group("WAMP Connect"),console.info(r._wsuri),console.log(r._websocket.protocol),console.groupEnd()),r._websocket_connected=!0},r._websocket.onerror=function(){},r._websocket.onclose=function(e){ab._debugws&&console.log(r._websocket_connected?"Autobahn connection to "+r._wsuri+" lost (code "+e.code+", reason '"+e.reason+"', wasClean "+e.wasClean+").":"Autobahn could not connect to "+r._wsuri+" (code "+e.code+", reason '"+e.reason+"', wasClean "+e.wasClean+")."),void 0!==r._websocket_onclose&&(r._websocket_connected?e.wasClean?r._websocket_onclose(ab.CONNECTION_CLOSED,"WS-"+e.code+": "+e.reason):r._websocket_onclose(ab.CONNECTION_LOST):r._websocket_onclose(ab.CONNECTION_UNREACHABLE)),r._websocket_connected=!1,r._wsuri=null,r._websocket_onopen=null,r._websocket_onclose=null,r._websocket=null}},ab.Session.prototype._send=function(e){var n=this;if(!n._websocket_connected)throw"Autobahn not connected";var t=JSON.stringify(e);n._websocket.send(t),n._txcnt+=1,ab._debugws&&(console.group("WS Send"),console.info(n._wsuri+"  ["+n._session_id+"]"),console.log(n._txcnt),console.log(t),console.groupEnd())},ab.Session.prototype.close=function(){var e=this;e._websocket_connected&&e._websocket.close()},ab.Session.prototype.sessionid=function(){var e=this;return e._session_id},ab.Session.prototype.shrink=function(e,n){var t=this;return void 0===n&&(n=!0),t._prefixes.shrink(e,n)},ab.Session.prototype.resolve=function(e,n){var t=this;return void 0===n&&(n=!0),t._prefixes.resolve(e,n)},ab.Session.prototype.prefix=function(e,n){var t=this;t._prefixes.set(e,n),(ab._debugrpc||ab._debugpubsub)&&(console.group("WAMP Prefix"),console.info(t._wsuri+"  ["+t._session_id+"]"),console.log(e),console.log(n),console.groupEnd());var o=[ab._MESSAGE_TYPEID_PREFIX,e,n];t._send(o)},ab.Session.prototype.call=function(){for(var e,n=this,t=new ab._Deferred;;)if(e=ab._newidFast(),!(e in n._calls))break;n._calls[e]=t;for(var o=n._prefixes.shrink(arguments[0],!0),r=[ab._MESSAGE_TYPEID_CALL,e,o],i=1;i<arguments.length;i+=1)r.push(arguments[i]);return n._send(r),ab._debugrpc&&(t._ab_callobj=r,t._ab_tid=n._wsuri+"  ["+n._session_id+"]["+e+"]",console.time(t._ab_tid),console.info()),t},ab.Session.prototype.subscribe=function(e,n){var t=this,o=t._prefixes.resolve(e,!0);if(!(o in t._subscriptions)){ab._debugpubsub&&(console.group("WAMP Subscribe"),console.info(t._wsuri+"  ["+t._session_id+"]"),console.log(e),console.log(n),console.groupEnd());var r=[ab._MESSAGE_TYPEID_SUBSCRIBE,e];t._send(r),t._subscriptions[o]=[]}var i=t._subscriptions[o].indexOf(n);if(-1!==i)throw"callback "+n+" already subscribed for topic "+o;t._subscriptions[o].push(n)},ab.Session.prototype.unsubscribe=function(e,n){var t=this,o=t._prefixes.resolve(e,!0);if(!(o in t._subscriptions))throw"not subscribed to topic "+o;var r;if(void 0!==n){var i=t._subscriptions[o].indexOf(n);if(-1===i)throw"no callback "+n+" subscribed on topic "+o;r=n,t._subscriptions[o].splice(i,1)}else r=t._subscriptions[o].slice(),t._subscriptions[o]=[];if(0===t._subscriptions[o].length){delete t._subscriptions[o],ab._debugpubsub&&(console.group("WAMP Unsubscribe"),console.info(t._wsuri+"  ["+t._session_id+"]"),console.log(e),console.log(r),console.groupEnd());var s=[ab._MESSAGE_TYPEID_UNSUBSCRIBE,e];t._send(s)}},ab.Session.prototype.publish=function(){var e=this,n=arguments[0],t=arguments[1],o=null,r=null,i=null,s=null;if(arguments.length>3){if(!(arguments[2]instanceof Array))throw"invalid argument type(s)";if(!(arguments[3]instanceof Array))throw"invalid argument type(s)";r=arguments[2],i=arguments[3],s=[ab._MESSAGE_TYPEID_PUBLISH,n,t,r,i]}else if(arguments.length>2)if("boolean"==typeof arguments[2])o=arguments[2],s=[ab._MESSAGE_TYPEID_PUBLISH,n,t,o];else{if(!(arguments[2]instanceof Array))throw"invalid argument type(s)";r=arguments[2],s=[ab._MESSAGE_TYPEID_PUBLISH,n,t,r]}else s=[ab._MESSAGE_TYPEID_PUBLISH,n,t];ab._debugpubsub&&(console.group("WAMP Publish"),console.info(e._wsuri+"  ["+e._session_id+"]"),console.log(n),console.log(t),null!==o?console.log(o):null!==r&&(console.log(r),null!==i&&console.log(i)),console.groupEnd()),e._send(s)},ab.Session.prototype.authreq=function(e,n){return this.call("http://api.wamp.ws/procedure#authreq",e,n)},ab.Session.prototype.authsign=function(e,n){return n||(n=""),CryptoJS.HmacSHA256(e,n).toString(CryptoJS.enc.Base64)},ab.Session.prototype.auth=function(e){return this.call("http://api.wamp.ws/procedure#auth",e)},ab._connect=function(e){var n=new ab.Session(e.wsuri,function(){e.connects+=1,e.retryCount=0,e.onConnect(n)},function(n,t){switch(n){case ab.CONNECTION_CLOSED:e.onHangup(n,"Connection was closed properly ["+t+"]");break;case ab.CONNECTION_UNSUPPORTED:e.onHangup(n,"Browser does not support WebSocket.");break;case ab.CONNECTION_UNREACHABLE:if(e.retryCount+=1,0==e.connects)e.onHangup(n,"Connection could not be established.");else if(e.retryCount<=e.options.maxRetries){var o=e.onHangup(ab.CONNECTION_UNREACHABLE_SCHEDULED_RECONNECT,"Connection unreachable - scheduled reconnect to occur in "+e.options.retryDelay/1e3+" second(s).",{delay:e.options.retryDelay,retries:e.retryCount,maxretries:e.options.maxRetries});o?(console.log("Connection unreachable - retrying stopped by app"),e.onHangup(ab.CONNECTION_RETRIES_EXCEEDED,"Number of connection retries exceeded.")):(console.log("Connection unreachable - retrying ("+e.retryCount+") .."),window.setTimeout(ab._connect,e.options.retryDelay,e))}else e.onHangup(ab.CONNECTION_RETRIES_EXCEEDED,"Number of connection retries exceeded.");break;case ab.CONNECTION_LOST:if(e.retryCount+=1,e.retryCount<=e.options.maxRetries){var o=e.onHangup(ab.CONNECTION_LOST_SCHEDULED_RECONNECT,"Connection lost - scheduled reconnect to occur in "+e.options.retryDelay/1e3+" second(s).",{delay:e.options.retryDelay,retries:e.retryCount,maxretries:e.options.maxRetries});o?(console.log("Connection lost - retrying stopped by app"),e.onHangup(ab.CONNECTION_RETRIES_EXCEEDED,"Connection lost.")):(console.log("Connection lost - retrying ("+e.retryCount+") .."),window.setTimeout(ab._connect,e.options.retryDelay,e))}else e.onHangup(ab.CONNECTION_RETRIES_EXCEEDED,"Connection lost.");break;default:throw"unhandled close code in ab._connect"}},e.options)},ab.connect=function(e,n,t,o){var r={};if(r.wsuri=e,r.options=o?o:{},void 0==r.options.retryDelay&&(r.options.retryDelay=5e3),void 0==r.options.maxRetries&&(r.options.maxRetries=10),void 0==r.options.skipSubprotocolCheck&&(r.options.skipSubprotocolCheck=!1),void 0==r.options.skipSubprotocolAnnounce&&(r.options.skipSubprotocolAnnounce=!1),!n)throw"onConnect handler required!";
r.onConnect=n,r.onHangup=t?t:function(e,n){console.log(n)},r.connects=0,r.retryCount=0,ab._connect(r)},ab._UA_FIREFOX=new RegExp(".*Firefox/([0-9+]*).*"),ab._UA_CHROME=new RegExp(".*Chrome/([0-9+]*).*"),ab._UA_CHROMEFRAME=new RegExp(".*chromeframe/([0-9]*).*"),ab._UA_WEBKIT=new RegExp(".*AppleWebKit/([0-9+.]*)w*.*"),ab._UA_WEBOS=new RegExp(".*webOS/([0-9+.]*)w*.*"),ab._matchRegex=function(e,n){var t=n.exec(e);return t?t[1]:t},ab.lookupWsSupport=function(){var e=navigator.userAgent;if(e.indexOf("MSIE")>-1){if(e.indexOf("MSIE 10")>-1)return[!0,!0,!0];if(e.indexOf("chromeframe")>-1){var n=parseInt(ab._matchRegex(e,ab._UA_CHROMEFRAME));return n>=14?[!0,!1,!0]:[!1,!1,!1]}return e.indexOf("MSIE 8")>-1||e.indexOf("MSIE 9")>-1?[!0,!0,!0]:[!1,!1,!1]}if(e.indexOf("Firefox")>-1){var n=parseInt(ab._matchRegex(e,ab._UA_FIREFOX));return n?n>=7?[!0,!1,!0]:n>=3?[!0,!0,!0]:[!1,!1,!0]:[!1,!1,!0]}if(e.indexOf("Safari")>-1&&-1==e.indexOf("Chrome")){var n=ab._matchRegex(e,ab._UA_WEBKIT);return n?e.indexOf("Windows")>-1&&"534+"==n?[!0,!1,!0]:e.indexOf("Macintosh")>-1&&(n=n.replace("+","").split("."),535==parseInt(n[0])&&parseInt(n[1])>=24||parseInt(n[0])>535)?[!0,!1,!0]:e.indexOf("webOS")>-1?(n=ab._matchRegex(e,ab._UA_WEBOS).split("."),2==parseInt(n[0])?[!1,!0,!0]:[!1,!1,!1]):[!0,!0,!0]:[!1,!1,!1]}if(e.indexOf("Chrome")>-1){var n=parseInt(ab._matchRegex(e,ab._UA_CHROME));return n?n>=14?[!0,!1,!0]:n>=4?[!0,!0,!0]:[!1,!1,!0]:[!1,!1,!1]}return e.indexOf("Android")>-1?e.indexOf("Firefox")>-1?[!0,!1,!0]:e.indexOf("CrMo")>-1?[!0,!1,!0]:e.indexOf("Opera")>-1?[!1,!1,!0]:e.indexOf("CrMo")>-1?[!0,!0,!0]:[!1,!1,!1]:e.indexOf("iPhone")>-1||e.indexOf("iPad")>-1||e.indexOf("iPod")>-1?[!1,!1,!0]:[!1,!1,!1]};var cakeWamp=window.cakeWamp||{};cakeWamp.subscriptions=[],cakeWamp.onconnectListeners=[],cakeWamp.onhangupListeners=[],cakeWamp.connect=function(){cakeWamp.options&&cakeWamp.options.debugWamp&&(ab._debugrpc=!0,ab._debugpubsub=!0),cakeWamp.options&&cakeWamp.options.debugWs&&(ab._debugws=!0),ab.connect(wsuri,function(e){cakeWamp.session=e,cakeWamp.onconnect()},function(e,n){cakeWamp.onhangup(e,n)},cakeWamp.options)},cakeWamp.onconnect=function(){for(var e in cakeWamp.onconnectListeners)cakeWamp.onconnectListeners[e](cakeWamp.session);for(var n in cakeWamp.subscriptions)cakeWamp.session.subscribe(cakeWamp.subscriptions[n].topic,cakeWamp.subscriptions[n].callback)},cakeWamp.onhangup=function(e,n){for(var t in cakeWamp.onhangupListeners)cakeWamp.onhangupListeners[t](e,n)},cakeWamp.call=function(){return cakeWamp.session.call.apply(cakeWamp.session,arguments)},cakeWamp.subscribe=function(){cakeWamp.subscriptions.push({topic:arguments[0],callback:arguments[1]}),cakeWamp.session&&cakeWamp.session._websocket_connected&&cakeWamp.session.subscribe.apply(cakeWamp.session,arguments)},cakeWamp.unsubscribe=function(){cakeWamp.session.unsubscribe.apply(cakeWamp.session,arguments)},cakeWamp.publish=function(){cakeWamp.session.publish.apply(cakeWamp.session,arguments)},cakeWamp.connect();